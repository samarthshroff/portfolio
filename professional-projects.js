export const professionalProjectsContent = {
    projects: [
        {
            title: "World of Peppa Pig",
            description: `
                <p>Game Development, Platform SDK Development and Revenue Optimization:</p>
                <ul>
                    <li>Revenue & User Growth: Drove significant revenue and user growth for a platform generating $10M in annual revenue and reaching 2M monthly active users (MAU).</li>
                    <li>Revenue & Conversion Enhancement: Increased yearly revenue by $500K and conversion rates by 20% through the development and implementation of a localized paywall and purchase system.</li>
                    <li>Maintenance Reduction: Decreased project maintenance complexity by 40% through the implementation of a forced update system.</li>
                    <li>User Engagement Improvement: Boosted user engagement by 30% through the integration of comprehensive analytics services.</li>
                    <li>Performance Optimization: Optimized app performance using Firebase Remote Config for A/B testing and real-time updates. Further enhanced user experience and reduced app size by designing an asset delivery system utilizing Unity Addressables.</li>
                    <li>Development Efficiency: Reduced development and integration time by creating and implementing custom Editor tools using C# and Python.</li> 
                    <li>Agile Development & Integrations: Led SCRUM-based regular releases, automation initiatives, and platform SDK integrations.</li>
                </ul>
            `,
            technologies: ["Unity", "C#", "RevenueCat", "Firebase", "Unity Gaming Services", "Cognito"],
            image: "../assets/professional-projects/wopp/main.png",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/wopp/main.png' },
                { type: 'video', src: '../assets/professional-projects/wopp/vid1' },
                { type: 'image', src: '../assets/professional-projects/wopp/1.png' },
                { type: 'image', src: '../assets/professional-projects/wopp/2.png' },
                { type: 'video', src: '../assets/professional-projects/wopp/vid2' },
                { type: 'video', src: '../assets/professional-projects/wopp/vid3' },                
                { type: 'image', src: '../assets/professional-projects/wopp/3.png' },
                { type: 'image', src: '../assets/professional-projects/wopp/4.png' },
                { type: 'image', src: '../assets/professional-projects/wopp/5.png' },
                { type: 'image', src: '../assets/professional-projects/wopp/6.png' }
            ]
        },
        {
            title: "Cricket Premier League",
            description: `
                <p>Played a pivotal role in the development of a mobile cricket game that allows players to compete in a premier league, build their dream team, and challenge friends and family on the leaderboard.</p>
                <ul>
                    <li>Programming the entire client-side logic for core game systems, including the score system and leaderboard functionality, using cocos2dx 3.9.</li>
                    <li>Contributing to a game that achieved notable success on the Google Play Store, ranking #3 in 'Top Free' and #1 in 'Top New Free' on May 10, 2016.</li>
                </ul>
            `,
            technologies: ["C++", "Cocos2dx"],
            image: "../assets/professional-projects/cpl/main.png",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/cpl/main.png' },
                { type: 'image', src: '../assets/professional-projects/cpl/2.png' },
                { type: 'image', src: '../assets/professional-projects/cpl/3.png' },
                { type: 'image', src: '../assets/professional-projects/cpl/4.png' },
                { type: 'image', src: '../assets/professional-projects/cpl/5.png' }
            ]
        },
        {
            title: "Nazara Cricket",
            description: `
                <p>Crucial role in enhancing the gameplay experience of Nazara Cricket, a mobile cricket game featuring detailed player characters, huge collection of typical shots of individual players and real-time multiplayer. </p>
                <ul>
                    <li>Developing and integrating ad network modules for effective monetization.</li>
                    <li>Implementing new game logic to refine gameplay mechanics, improving player engagement and overall game flow.</li>
                    <li>Worked to ensure high performance and stability within the multiplayer environment.</li>
                </ul>
            `,
            technologies: ["C++", "Cocos2dx"],
            image: "../assets/professional-projects/nc/main.png",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/nc/main.png' },
                { type: 'image', src: '../assets/professional-projects/nc/2.png' },
                { type: 'image', src: '../assets/professional-projects/nc/3.png' },
                { type: 'image', src: '../assets/professional-projects/nc/4.png' },
                { type: 'image', src: '../assets/professional-projects/nc/5.png' }
            ]
        },
        {
            title: "Salem: Lost Chronicles",
            description: `
                <p>Spearheaded the client-side development of "Lost Chronicles: Salem," a narrative-driven adventure game set in 1692.</p>
                <p>Utilizing cocos2dx (C++), I was responsible for all programming aspects, including:</p>
                <ul>
                    <li>Implementing core gameplay systems, puzzle mechanics, and hidden object scenes.</li>
                    <li>Integrating and managing third-party APIs for social media (Facebook, Twitter), advertising (Chartboost), achievements (Game Center/Google Play), analytics (Google Analytics), and local notifications.</li>
                    <li>Developing seamless bridges between cocos2dx and native iOS (Objective-C) and Android (Java) code for platform-specific features.</li>
                </ul>
            `,
            technologies: ["C++", "Cocos2dx"],
            image: "../assets/professional-projects/salem/main.png",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/salem/main.png' },
                { type: 'image', src: '../assets/professional-projects/salem/1.png' },
                { type: 'image', src: '../assets/professional-projects/salem/2.png' },
                { type: 'image', src: '../assets/professional-projects/salem/3.png' },
                { type: 'image', src: '../assets/professional-projects/salem/4.png' },
                { type: 'image', src: '../assets/professional-projects/salem/5.png' }
            ]
        },
        {
            title: "Empire Of a Billionaire",
            description: `
                <p>Provided critical pre-production and development support for "Empire of a Billionaire," a city-building strategy game with casual gameplay elements.</p>
                <p>My responsibilities included:</p>
                <ul>
                    <li>Developing comprehensive class diagrams and technical design documentation.</li>
                    <li>Establishing project structure and defining naming conventions for graphical assets.</li>
                    <li>Contributing to the refinement of core game design principles.</li>
                    <li>Assisting in the implementation of complex game logic using cocos2dx (C++).</li>
                </ul>
            `,
            technologies: ["C++", "Cocos2dx"],
            image: "../assets/professional-projects/eob/main.png",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/eob/main.png' },
                { type: 'image', src: '../assets/professional-projects/eob/1.png' },
                { type: 'image', src: '../assets/professional-projects/eob/2.png' },
                { type: 'image', src: '../assets/professional-projects/eob/3.png' },
                { type: 'image', src: '../assets/professional-projects/eob/4.png' },
                { type: 'image', src: '../assets/professional-projects/eob/5.png' }
            ]
        },
        {
            title: "Sensible Soccer Skills",
            description: `
                <p>Contributed to the ongoing development and stability of a third-party purchased iOS soccer manager game, featuring strategic team management and 10 engaging mini-games.</p>
                <p>My responsibilities included:</p>
                <ul>
                    <li>Developing and integrating new features using Objective-C.</li>
                    <li>Identifying and resolving numerous crash issues, significantly improving game stability and user satisfaction.</li>
                </ul>
            `,
            technologies: ["Objective-C"],
            image: "../assets/professional-projects/sss/main.png",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/sss/main.png' },
                { type: 'image', src: '../assets/professional-projects/sss/1.jpeg' },
                { type: 'image', src: '../assets/professional-projects/sss/2.jpeg' },
                { type: 'image', src: '../assets/professional-projects/sss/3.jpeg' },
                { type: 'image', src: '../assets/professional-projects/sss/4.jpeg' },
                { type: 'image', src: '../assets/professional-projects/sss/5.jpeg' }
            ]
        },
        {
            title: "More Projects",
            description: `
                <p>More Live Projects that I have worked on.</p>
                <ul>
                    <li>Unity 3D (C#) Hidden Object Game Reskin: A reskin for a 3D hidden object game, utilizing Unity 3D and C#.</li>
                    <li>Cab in the City (iOS/Android): Served as the lead developer for this Unity 3D project, and another unreleased Unity 3D game.</li>
                    <li>SABurbia.com: Contributed to pre-production tasks, including class diagram and technical design document creation. Implemented pthread, XML parsing, and HTTP connection (cURL) functionalities in C++.</li>
                    <li>Team Lead Experience: Led development teams for the following projects:</li>
                        <li>Traffic Controller (iOS/Android)</li>
                        <li>Nectar Hunt (iOS)</li>
                        <li>Titanic's Keys of the Past (iOS/Android)</li>
                    <li>The Lost Cases of 221B Baker Street: Provided critical technical support, resolving numerous crash issues and integrating publisher and third-party APIs.</li>
                    <li>JavaMe Games: Developed several games using JavaMe (now obsolete).</li>
                </ul>
            `,
            technologies: ["Unity 3D", "C#", "Objective-C", "C++", "Cocos2dx", "JavaMe"],
            image: "../assets/professional-projects/others/main.jpeg",
            mediaItems: [
                { type: 'image', src: '../assets/professional-projects/others/main.jpeg' },
                { type: 'image', src: '../assets/professional-projects/others/1.jpeg' },
                { type: 'image', src: '../assets/professional-projects/others/2.jpeg' },
                { type: 'image', src: '../assets/professional-projects/others/3.jpeg' }
            ]
        }
    ]
};

export const setupProfessionalProjects = () => {
    const createProjectCard = (project) => {
        const card = document.createElement('div');
        card.classList.add('project-card-new'); // Use the new class

        card.innerHTML = `
            <div class="project-image-new">
                <img src="${project.image}" alt="${project.title}" />
            </div>
            <div class="project-content-new">
                <h3 class="project-title-new">${project.title}</h3>
                <ul class="project-tech-list-new">
                    ${project.technologies.map(tech => `<li>${tech}</li>`).join('')}
                </ul>
            </div>
        `;
        
        card.onclick = () => openModal(project.title, project.description, project.mediaItems);
        return card;
    };

    const projectsContainer = document.querySelector('.professional-projects .projects-grid');
    if (!projectsContainer) return;

    // Loop through the projects array
    professionalProjectsContent.projects.forEach((project) => {
        const projectCard = createProjectCard(project);
        projectsContainer.appendChild(projectCard);
    });
};

// Add this function to define the missing finishDrag function
window.finishDrag = function() {
    const carouselInner = document.querySelector('.carousel-inner');
    if (!window.isDragging) return;
    
    window.isDragging = false;
    carouselInner.style.cursor = 'grab';
    
    // Determine if it was a significant drag or just a click
    const endX = event.pageX || (event.changedTouches && event.changedTouches[0].clientX);
    const startX = window.startX;
    const threshold = 50; // pixels
    
    if (startX && endX && Math.abs(startX - endX) > threshold) {
        // It was a significant drag, move in the direction of the drag
        if (startX > endX) {
            moveCarousel(1); // Move forward
        } else {
            moveCarousel(-1); // Move backward
        }
    }
}

// Modal functionality
// Update the video creation in the openModal function

// Update the openModal function to properly initialize drag variables
window.openModal = (title, description, mediaItems) => {
    const modal = document.createElement('div');
    modal.classList.add('project-details-modal');
    
    // Create carousel navigation buttons
    const carouselNav = `
        <button class="carousel-control prev" onclick="moveCarousel(-1)">&#10094;</button>
        <button class="carousel-control next" onclick="moveCarousel(1)">&#10095;</button>
    `;
    
    // Create indicators for the carousel
    const indicators = `
        <div class="carousel-indicators">
            ${mediaItems.map((_, index) => 
                `<span class="indicator ${index === 0 ? 'active' : ''}" 
                  onclick="jumpToSlide(${index})"></span>`
            ).join('')}
        </div>
    `;
    
    modal.innerHTML = `
        <div class="details-modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>${title}</h2>
            <div class="media-section">
                ${carouselNav}
                <div class="carousel">                    
                    <div class="carousel-inner">
                        ${mediaItems.map((item, index) => `
                            <div class="carousel-item ${index === 0 ? 'active' : ''}">
                                ${item.type === 'video' ? 
                                    `<video ${index === 0 ? 'autoplay' : ''} controls muted>
                                        <source src="${item.src}.mp4" type="video/mp4">
                                        <source src="${item.src}.mov" type="video/quicktime">
                                        Your browser does not support the video tag.
                                    </video>` : 
                                    `<img src="${item.src}" alt="${title}" />`}
                            </div>
                        `).join('')}
                    </div>                    
                </div>
                ${indicators}
            </div>
            <div class="description-section">
                <div>${description}</div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Initialize the carousel
    initCarousel(mediaItems.length);
    
    // Initialize global variables for carousel tracking
    window.totalSlides = mediaItems.length;
    window.currentSlide = 0;
    window.isDragging = false;
    window.startX = null;
    window.startScrollLeft = null;
    
    // Play the video on the first slide if it's a video
    const firstSlideVideo = modal.querySelector('.carousel-item.active video');
    if (firstSlideVideo) {
        // Need to add a slight delay to make sure the video is loaded properly
        setTimeout(() => {
            firstSlideVideo.play().catch(e => console.log("Initial autoplay prevented:", e));
        }, 100);
    }
    
    // Add touch and swipe event listeners
    const carouselInner = modal.querySelector('.carousel-inner');
    
    // Mouse events for desktop
    carouselInner.addEventListener('mousedown', (e) => {
        window.isDragging = true;
        window.startX = e.pageX;
        window.startScrollLeft = carouselInner.scrollLeft;
        carouselInner.style.cursor = 'grabbing';
    });
    
    carouselInner.addEventListener('mousemove', (e) => {
        if (!window.isDragging) return;
        e.preventDefault();
        const x = e.pageX;
        const walk = (x - window.startX) * 2; // Multiply by 2 for faster scrolling
        carouselInner.scrollLeft = window.startScrollLeft - walk;
    });
    
    carouselInner.addEventListener('mouseup', window.finishDrag);
    carouselInner.addEventListener('mouseleave', window.finishDrag);
    
    // Touch events for mobile
    carouselInner.addEventListener('touchstart', (e) => {
        window.isDragging = true;
        window.startX = e.touches[0].clientX;
        window.startScrollLeft = carouselInner.scrollLeft;
    });
    
    carouselInner.addEventListener('touchmove', (e) => {
        if (!window.isDragging) return;
        const x = e.touches[0].clientX;
        const walk = (x - window.startX) * 2;
        carouselInner.scrollLeft = window.startScrollLeft - walk;
    });
    
    carouselInner.addEventListener('touchend', window.finishDrag);
};

// Update the moveCarousel function to handle circular navigation
// Update the moveCarousel function to handle video autoplay/pause
window.moveCarousel = (direction) => {
    const items = document.querySelectorAll('.carousel-item');
    const indicators = document.querySelectorAll('.indicator');
    const totalItems = items.length;
    
    // Pause any currently playing videos
    const currentVideo = items[currentSlide].querySelector('video');
    if (currentVideo) {
        currentVideo.pause();
    }
    
    // Remove all active, prev, and next classes first
    items.forEach(item => {
        item.classList.remove('active', 'prev', 'next');
    });
    indicators[currentSlide].classList.remove('active');
    
    // Update current slide index with circular logic
    currentSlide = (currentSlide + direction + window.totalSlides) % window.totalSlides;
    
    // Add active class to current slide
    items[currentSlide].classList.add('active');
    indicators[currentSlide].classList.add('active');
    
    // Autoplay video if the current slide contains one
    const newVideo = items[currentSlide].querySelector('video');
    if (newVideo) {
        // Reset the video to the beginning
        newVideo.currentTime = 0;
        // Start playing
        newVideo.play().catch(e => console.log("Autoplay prevented:", e));
    }
    
    // Add prev class to the item before current
    const prevIndex = (currentSlide - 1 + totalItems) % totalItems;
    items[prevIndex].classList.add('prev');
    
    // Add next class to the item after current
    const nextIndex = (currentSlide + 1) % totalItems;
    items[nextIndex].classList.add('next');
    
    // Smooth scroll to the current slide
    items[currentSlide].scrollIntoView({
        behavior: 'smooth',
        block: 'nearest',
        inline: 'center'
    });
};

// Update the jumpToSlide function as well for video handling
window.jumpToSlide = (index) => {
    const items = document.querySelectorAll('.carousel-item');
    const indicators = document.querySelectorAll('.indicator');
    const totalItems = items.length;
    
    // Pause any currently playing videos
    const currentVideo = items[currentSlide].querySelector('video');
    if (currentVideo) {
        currentVideo.pause();
    }
    
    // Remove all active, prev, and next classes
    items.forEach(item => {
        item.classList.remove('active', 'prev', 'next');
    });
    indicators[currentSlide].classList.remove('active');
    
    // Set current slide to the requested index
    currentSlide = index;
    
    // Add active class to new current slide
    items[currentSlide].classList.add('active');
    indicators[currentSlide].classList.add('active');
    
    // Autoplay video if the current slide contains one
    const newVideo = items[currentSlide].querySelector('video');
    if (newVideo) {
        // Reset the video to the beginning
        newVideo.currentTime = 0;
        // Start playing
        newVideo.play().catch(e => console.log("Autoplay prevented:", e));
    }
    
    // Add prev class to the item before current
    const prevIndex = (currentSlide - 1 + totalItems) % totalItems;
    items[prevIndex].classList.add('prev');
    
    // Add next class to the item after current
    const nextIndex = (currentSlide + 1) % totalItems;
    items[nextIndex].classList.add('next');
    
    // Smooth scroll to the current slide
    items[currentSlide].scrollIntoView({
        behavior: 'smooth',
        block: 'nearest',
        inline: 'center'
    });
};

// Initialize the carousel
window.initCarousel = (totalSlides) => {
    const items = document.querySelectorAll('.carousel-item');
    
    items.forEach((item, index) => {
        item.style.display = 'block';
        
        // Set first item as active
        if (index === 0) {
            item.classList.add('active');
        }
    });
    
    // Make the carousel items sized appropriately
    const carousel = document.querySelector('.carousel-inner');
    if (carousel) {
        carousel.style.width = `${totalSlides * 100}%`;
        
        items.forEach(item => {
            item.style.width = `${100 / totalSlides}%`;
        });
    }
};


// Close modal also needs to pause any playing videos
window.closeModal = () => {
    const modal = document.querySelector('.project-details-modal');
    if (modal) {
        // Stop any playing videos before removing
        const videos = modal.querySelectorAll('video');
        videos.forEach(video => {
            video.pause();
        });
        modal.remove();
    }
};
